<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
    </style>
    <script type="importmap">
        {
          "imports": {
            "three": "../lib/build/three.module.js",
            "three/addons/": "../lib/examples/jsm/"
          }
        }
    </script>
</head>
<body>
<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/OrbitControls.js';
    import Stats from 'three/addons/libs/stats.module.js';

    // 相机输出画布尺寸，单位px
    const width = window.innerWidth;
    const height = window.innerHeight;

    // 场景
    const scene = new THREE.Scene();

    const geometry = new THREE.BoxGeometry(100, 100, 100);
    const material = new THREE.MeshLambertMaterial({
        color: 0x00ff00,
        transparent: true,
        opacity: 0.5,
    });

    // 批量创建几何体
    for (let i = 0; i < 10; i++) {
        for (let j = 0; j < 10; j++) {
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(i * 200, 0, j * 200);
            scene.add(mesh);
        }
    }

    const axesHelper = new THREE.AxesHelper(150);
    scene.add(axesHelper);

    // 添加一个环境光
    const ambient = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambient);

    // 添加一个平行光
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
    directionalLight.position.set(50, 100, 60);
    scene.add(directionalLight);

    // 可视化平行光
    const directionalLightHelper = new THREE.DirectionalLightHelper(directionalLight, 5, 0xff0000);
    scene.add(directionalLightHelper);

    // 透视投影相机
    const camera = new THREE.PerspectiveCamera(30, width / height, .1, 8000);
    camera.position.set(2000, 2000, 2000);
    scene.add(camera);
    // 相机的视线、观察目标点的坐标。相机对准的点
    camera.lookAt(1000, 0, 1000);
    // camera.lookAt(0, 0, 0); // 坐标原点

    // 渲染器
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(width, height);
    renderer.render(scene, camera);
    document.body.appendChild(renderer.domElement);

    const stats = new Stats();
    document.body.appendChild(stats.domElement);

    //
    function render() {
        stats.update();
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    }

    render();

    // 设置相机控件轨道控制器
    const controls = new OrbitControls(camera, renderer.domElement);
    // 与lookAt一致，因为相机控件OrbitControls会影响lookAt的设置
    controls.target.set(1000, 0, 1000);
    controls.update();
    controls.addEventListener('change', () => {
        // 因为上面已经有了渲染循环，所以此处可以注释
        // renderer.render(scene, camera);
    });

    // 自适应
    window.onresize = function () {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;
        // 如果相机的属性发生了变化，需要执行updateProjectionMatrix
        camera.updateProjectionMatrix();
    }
</script>
</body>
</html>